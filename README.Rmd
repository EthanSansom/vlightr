---
output: github_document
always_allow_html: yes
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE, cache = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  cache = FALSE,
  asciicast_at = "end",
  asciicast_theme = if (Sys.getenv("IN_PKGDOWN") == "true") "pkgdown" else "readme"
)
asciicast::init_knitr_engine(
  startup = quote({
    library(cli)
    library(vlightr)
    options(cli.num_colors = cli::truecolor)
    set.seed(1)
  }),
  echo = TRUE,
  echo_input = FALSE
)
```

# vlightr

<!-- badges: start -->

<!-- badges: end -->

vlightr is a package for conditionally formatting vectors. You can `highlight()`
a vector to style, colour, or otherwise re-format it's elements when the vector 
is printed or formatted. Highlights are persistent, meaning highlighted vectors 
can be manipulated (with minimal legwork) while maintaining their custom formatting.

# Installation

You can install the development version of vlightr from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("EthanSansom/vlightr")
```

# Features

```{r load-pkg, include = FALSE}
library(vlightr)
```

## Conditional Formatting

Apply a custom format to elements of `x` for which a condition returns `TRUE`.
For example, color `NA` values red (as they would appear in a `tibble::tibble()`).

```{asciicast red-nas1}
x <- c(1L, 0L, NA, 1L, 0L)
x_hl <- vlightr::highlight(x, is.na, vlightr::colour("red"))
print(x_hl)
```

## Manipulate Highlighted Data

Highlighted vectors play well with other highlighted vectors. The shorthand 
`hl()` is useful for quick highlighting.

```{asciicast operation}
# Arithmetic
x_hl + vlightr::hl(10L)
```

```{asciicast assign}
# Assignment
x_hl[[1]] <- vlightr::hl(NA)
x_hl
```

```{asciicast coerce}
# Coercion
c(x_hl, vlightr::hl(c(-1.5, NA)))
```

## Highlight, Unhighlight, Rehighlight

Highlighted vectors can't be implicitly coerced or converted to other vector 
types. To use a function which expects the highlight's underlying vector type, 
first  `un_highlight()` (AKA `ul()`) to expose the highlighted data and then 
`re_highlight()` (AKA `rl()`) to re-apply the conditional formatting.

```{asciicast rehighlight1}
x_hl |>
  ul() |>
  as.logical() |>
  rl(x_hl)
```

The "highlight-pipe" `%hl>%` wraps the `magrittr::%>%` to do this automatically.

```{asciicast rehighlight2}
x_hl %hl>% as.logical()
```

An error like the below will is raised when attempting to convert a
`vlighter_highlight` vector to another class.

```{asciicast rehighlight3}
try(as.logical(x_hl))
```

## Multiple Conditional Formats

```{asciicast multiple-formats}
dummies <- vlightr::highlight(
  x = x,
  conditions = list(
    is.na, 
    ~ .x == 1, 
    ~ .x == 0
  ),
  formatters = list(
    vlightr::colour("red"), 
    ~ paste(.x, "[Yes]"),
    ~ paste(.x, "[No]")
  )
)
dummies
```

## Re-Use Highlights

```{asciicast highlighter}
dummy_highlighter <- vlightr::as_highlighter(dummies)
dummy_highlighter(c(0, 1, NA))
```

## Use `dplyr::case_when()` Style Syntax 

```{asciicast case-syntax}
bad_words <- c("darn", "gosh")
affirmations <- c("good job", "way-to-go")
message <- c("hey", "good job", "but", "darn", "please", "don't", "say", "gosh")

vlightr::highlight_case(
  message,
  .x %in% bad_words ~ \(x) strrep("X", nchar(x)),
  .x %in% affirmations ~ \(x) toupper(x),
  TRUE ~ cli::style_italic
)
```

## Highlight Arbitrary Vectors

Highlighted vectors are generic, meaning that S3 and S4 vector classes from 
other packages are highlight-able.

```{asciicast generic}
library(lubridate, warn.conflicts = FALSE)

today <- ymd("2020-01-01")
meeting_times <- interval(
  today + hours(c(9, 11, 16)), 
  today + hours(c(10, 13, 17))
)
lunch_break <- interval(today + hours(12), today + hours(13))
is_during_lunch <- function(x) int_overlaps(x, lunch_break)

vlightr::highlight(meeting_times, is_during_lunch, cli::col_magenta)
```
